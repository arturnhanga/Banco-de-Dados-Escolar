-- BASE DE DADOS
CREATE DATABASE COLEGIO_ITEVANDO_;
USE COLEGIO_ITEVANDO_;

-- FUNCIONARIOS (todos os funcionários da escola)
CREATE TABLE FUNCIONARIOS (
    COD_FUNCIONARIO INT PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL,
    FUNCAO VARCHAR(30) NOT NULL,
    IDADE INT
);
SELECT*FROM FUNCIONARIOS;

-- PROFESSOR (apoio de FUNCIONARIOS)
CREATE TABLE PROFESSOR (
    COD_PROFESSOR INT PRIMARY KEY,
    COD_FUNCIONARIO INT NOT NULL,
    DISCIPLINA VARCHAR(50) NOT NULL,
    NIVEL VARCHAR(30) NOT NULL,
    FOREIGN KEY (COD_FUNCIONARIO) REFERENCES FUNCIONARIOS(COD_FUNCIONARIO)
);
SELECT*FROM PROFESSOR;

-- TURMA
CREATE TABLE TURMA (
    COD_TURMA INT PRIMARY KEY,
    NOME_TURMA VARCHAR(10) NOT NULL,
    ANO_LETIVO INT NOT NULL
);
SELECT*FROM TURMA;

-- ALUNOS
CREATE TABLE ALUNOS (
    COD_ALUNO INT PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL,
    CURSO VARCHAR(30) NOT NULL,
    CLASSE INT NOT NULL
);
SELECT*FROM ALUNOS;

-- MATRÍCULA (relaciona aluno e turma)
CREATE TABLE MATRICULA (
    COD_MATRICULA INT PRIMARY KEY,
    COD_ALUNO INT NOT NULL,
    COD_TURMA INT NOT NULL,
    DATA_MATRICULA DATE NOT NULL,
    FOREIGN KEY (COD_ALUNO) REFERENCES ALUNOS(COD_ALUNO),
    FOREIGN KEY (COD_TURMA) REFERENCES TURMA(COD_TURMA)
);
SELECT*FROM MATRICULA;

-- TURMA_PROFESSOR (relaciona professor com turma)
CREATE TABLE TURMA_PROFESSOR (
    COD_TURMA INT NOT NULL,
    COD_PROFESSOR INT NOT NULL,
    PRIMARY KEY (COD_TURMA, COD_PROFESSOR),
    FOREIGN KEY (COD_TURMA) REFERENCES TURMA(COD_TURMA),
    FOREIGN KEY (COD_PROFESSOR) REFERENCES PROFESSOR(COD_PROFESSOR)
);
SELECT*FROM TURMA_PROFESSOR;

-- INSERIR FUNCIONÁRIOS E PROFESSORES

INSERT INTO FUNCIONARIOS VALUES (1,'Carlos Mendes','Professor',40);
INSERT INTO FUNCIONARIOS VALUES (2,'Joana Silva','Professor',35);
INSERT INTO FUNCIONARIOS VALUES (3,'Rui Mateus','Professor',50);
INSERT INTO FUNCIONARIOS VALUES (4,'Paula Rocha','Professor',29);
INSERT INTO FUNCIONARIOS VALUES (5,'Marcos Lima','Professor',45);

INSERT INTO PROFESSOR VALUES (1,1,'Matemática','Secundário');
INSERT INTO PROFESSOR VALUES (2,2,'Português','Secundário');
INSERT INTO PROFESSOR VALUES (3,3,'Física','Secundário');
INSERT INTO PROFESSOR VALUES (4,4,'Química','Secundário');
INSERT INTO PROFESSOR VALUES (5,5,'Informática','Técnico');

-- INSERIRINDO TURMAS

INSERT INTO TURMA VALUES (1,'10A',2025);
INSERT INTO TURMA VALUES (2,'11A',2025);

-- INSERIRINDO ALUNOS

INSERT INTO ALUNOS VALUES (1,'Ana Maria','InfoGest',10);
INSERT INTO ALUNOS VALUES (2,'Bruno Costa','InfoGest',10);
INSERT INTO ALUNOS VALUES (3,'Carla Mendes','GestEmp',10);
INSERT INTO ALUNOS VALUES (4,'Daniel Rocha','GestEmp',10);
INSERT INTO ALUNOS VALUES (5,'Eva Lima','ContGest',10);
INSERT INTO ALUNOS VALUES (6,'Fábio Costa','InfoGest',11);
INSERT INTO ALUNOS VALUES (7,'Gisela Pires','InfoGest',11);
INSERT INTO ALUNOS VALUES (8,'Helder Nunes','GestEmp',11);
INSERT INTO ALUNOS VALUES (9,'Inês Silva','ContGest',11);
INSERT INTO ALUNOS VALUES (10,'João Paulo','ContGest',11);

-- INSERIR MATRÍCULAS (ligando alunos a turmas)

INSERT INTO MATRICULA VALUES (1,1,1,'2025-02-01');
INSERT INTO MATRICULA VALUES (2,2,1,'2025-02-01');
INSERT INTO MATRICULA VALUES (3,3,1,'2025-02-01');
INSERT INTO MATRICULA VALUES (4,4,1,'2025-02-01');
INSERT INTO MATRICULA VALUES (5,5,1,'2025-02-01');

INSERT INTO MATRICULA VALUES (6,6,2,'2025-02-01');
INSERT INTO MATRICULA VALUES (7,7,2,'2025-02-01');
INSERT INTO MATRICULA VALUES (8,8,2,'2025-02-01');
INSERT INTO MATRICULA VALUES (9,9,2,'2025-02-01');
INSERT INTO MATRICULA VALUES (10,10,2,'2025-02-01');

-- RELACIONAR PROFESSORES COM TURMAS

INSERT INTO TURMA_PROFESSOR VALUES (1,1);
INSERT INTO TURMA_PROFESSOR VALUES (1,2);
INSERT INTO TURMA_PROFESSOR VALUES (2,3);
INSERT INTO TURMA_PROFESSOR VALUES (2,4);
INSERT INTO TURMA_PROFESSOR VALUES (2,5);

-- CONSULTAS DE EXEMPLO

-- Alunos por turma
SELECT A.NOME AS ALUNO, T.NOME_TURMA
FROM ALUNOS A
JOIN MATRICULA M ON A.COD_ALUNO = M.COD_ALUNO
JOIN TURMA T ON M.COD_TURMA = T.COD_TURMA;

-- Professores por turma
SELECT F.NOME AS PROFESSOR, P.DISCIPLINA, T.NOME_TURMA
FROM PROFESSOR P
JOIN FUNCIONARIOS F ON P.COD_FUNCIONARIO = F.COD_FUNCIONARIO
JOIN TURMA_PROFESSOR TP ON P.COD_PROFESSOR = TP.COD_PROFESSOR
JOIN TURMA T ON TP.COD_TURMA = T.COD_TURMA;

-- Contagem de alunos por turma
SELECT T.NOME_TURMA, COUNT(M.COD_ALUNO) AS TOTAL_ALUNOS
FROM TURMA T
LEFT JOIN MATRICULA M ON T.COD_TURMA = M.COD_TURMA
GROUP BY T.NOME_TURMA;